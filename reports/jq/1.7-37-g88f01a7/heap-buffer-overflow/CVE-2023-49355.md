# A heap-buffer-overflow vulnerability in jq v1.7-37-g88f01a7
A heap buffer overflow vulnerability in jq v1.7-37-g88f01a7 allows an attacker to cause a denial of service via the decToString function at decNumber.c:3764. The reproduction process is as follows:  
**1. Environment**  
Ubuntu 18.04, 64 bit  
jq 1.7-37-g88f01a7  
Clang 6.0.0  
**2. Compilation**  
2.1 Clone the git repository:  
git clone https://github.com/jqlang/jq.git  
git checkout 88f01a7(latest commit)  
2.2 Commands for compilation:  
export CC="clang -fsanitize=address" && export CXX="clang++ -fsanitize=address"  
CFLAGS="-g -o0" CXXFLAGS="-g -o0"  
git submodule update --init  
autoreconf -i  
./configure --disable-shared --with-oniguruma=builtin  
make  
**3. Reproduction**  
./jq . $poc  
**ASAN report:**    
```
==16671==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200000d5e0 at pc 0x000000563db2 bp 0x7fffb0ecee40 sp 0x7fffb0ecee38
WRITE of size 1 at 0x60200000d5e0 thread T0
    #0 0x563db1  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x563db1)
    #1 0x562f5a  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x562f5a)
    #2 0x52bea0  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x52bea0)
    #3 0x556a6e  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x556a6e)
    #4 0x55956e  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x55956e)
    #5 0x516bd0  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x516bd0)
    #6 0x515c9c  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x515c9c)
    #7 0x7f463b4e0c86  (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)
    #8 0x41b589  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x41b589)

0x60200000d5e0 is located 0 bytes to the right of 16-byte region [0x60200000d5d0,0x60200000d5e0)
allocated by thread T0 here:
    #0 0x4db440  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x4db440)
    #1 0x536385  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x536385)
    #2 0x55956e  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x55956e)

SUMMARY: AddressSanitizer: heap-buffer-overflow (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/jq/AFL-vul/1.7/analysis/jq/jq+0x563db1) 
```
line number:
```
addr2line -e ./jq 0x563db1
~/jq/src/decNumber/decNumber.c:3764
```

The poc file is: [poc]()
