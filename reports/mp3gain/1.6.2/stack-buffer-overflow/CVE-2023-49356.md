# A stack buffer overflow vulnerability in MP3Gain v1.6.2
A stack buffer overflow vulnerability in MP3Gain v1.6.2 allows an attacker to cause a denial of service via the WriteMP3GainAPETag function at apetag.c:592.
The reproduction process is as follows:  

**1. Environment**  
Ubuntu 18.04, 64 bit  
mp3gain 1.6.2  
Clang 6.0.0  

**2. Compilation**  
export CC="clang -fsanitize=address" && export CXX="clang++ -fsanitize=address"  
CFLAGS="-g -o0" CXXFLAGS="-g -o0"  
sed -i 's/CC=/CC?=/' Makefile  
make

**3. Reproduction**  
A stack-buffer-overflow bug at WriteMP3GainAPETag function in apetag.c:592:  
./mp3gain poc-apetag.c_592-sbo  
**ASAN report:**
```
==16858==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7ffe67b1f624 at pc 0x0000004473fa bp 0x7ffe67b1f4a0 sp 0x7ffe67b1ec50  
WRITE of size 142 at 0x7ffe67b1f624 thread T0  
    #0 0x4473f9  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x4473f9)  
    #1 0x447726  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x447726)  
    #2 0x52ee53  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x52ee53)  
    #3 0x517c05  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x517c05)  
    #4 0x5256dd  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x5256dd)  
    #5 0x7fb8e1899c86  (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)  
    #6 0x41a569  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x41a569)  

Address 0x7ffe67b1f624 is located in stack of thread T0 at offset 132 in frame  
    #0 0x52d39f  (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x52d39f)  
  This frame has 3 object(s):  
    [32, 132) 'valueString' (line 411)  
    [176, 208) 'newFooter' (line 413) <== Memory access at offset 132 partially underflows this variable  
    [240, 272) 'newHeader' (line 414) <== Memory access at offset 132 partially underflows this variable  
HINT: this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext  
      (longjmp and C++ exceptions *are* supported)  
SUMMARY: AddressSanitizer: stack-buffer-overflow (/home/zclin/afl-vul-score/llvm_mode/research/path-collect-all-new-0524/path-collect-all-new/mp3gain/AFL-vul/1.6.2/analysis/mp3gain-1_6_2-src/mp3gain+0x4473f9)   
```
**line number:**
```
addr2line -e ./mp3gain 0x52ee53
~/mp3gain-1_6_2-src/apetag.c:592
```
The poc file is: [poc](https://github.com/linzc21/bug-reports/blob/main/pocs/mp3gain/1.6.2/stack-buffer-overflow/poc-apetag.c_592-sbo)




